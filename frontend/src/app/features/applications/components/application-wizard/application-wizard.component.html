<div class="application-wizard">
    <div class="container">
        <!-- Progress Header -->
        <div class="wizard-header">
            <h1 class="wizard-title">ุชูุฏูู ุทูุจ ุงูุชุญุงู</h1>
            <p class="wizard-subtitle">ุฃููู ุงูุฎุทูุงุช ุงูุชุงููุฉ ูุชูุฏูู ุทูุจู</p>

            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="getProgress()"></div>
            </div>

            <!-- Steps Indicator -->
            <div class="steps-indicator">
                @for (step of [1, 2, 3, 4]; track step) {
                <div class="step-item" [class.active]="step === currentStep()" [class.completed]="step < currentStep()"
                    (click)="goToStep(step)">
                    <div class="step-circle">
                        @if (step < currentStep()) { <span>โ</span>
                            } @else {
                            <span>{{ getStepIcon(step) }}</span>
                            }
                    </div>
                    <div class="step-label">{{ getStepTitle(step) }}</div>
                </div>
                }
            </div>
        </div>

        <!-- Wizard Content -->
        <div class="wizard-content">

            <!-- Step 1: Personal Information -->
            @if (currentStep() === 1) {
            <div class="wizard-step">
                <h2 class="step-title">{{ getStepIcon(1) }} ุงููุนูููุงุช ุงูุดุฎุตูุฉ</h2>

                <form [formGroup]="personalInfoForm" class="wizard-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>ุงูุงุณู ุงููุงูู *</label>
                            <input type="text" formControlName="full_name" placeholder="ุฃุฏุฎู ุงุณูู ุงููุงูู">
                            @if (personalInfoForm.get('full_name')?.invalid &&
                            personalInfoForm.get('full_name')?.touched) {
                            <span class="error">ุงูุงุณู ูุทููุจ (3 ุฃุญุฑู ุนูู ุงูุฃูู)</span>
                            }
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู *</label>
                            <input type="email" formControlName="email" placeholder="example@email.com">
                            @if (personalInfoForm.get('email')?.invalid && personalInfoForm.get('email')?.touched) {
                            <span class="error">ุจุฑูุฏ ุฅููุชุฑููู ุตุญูุญ ูุทููุจ</span>
                            }
                        </div>

                        <div class="form-group">
                            <label>ุฑูู ุงููุงุชู *</label>
                            <input type="tel" formControlName="phone" placeholder="+966XXXXXXXXX">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>ุชุงุฑูุฎ ุงููููุงุฏ *</label>
                            <input type="date" formControlName="date_of_birth">
                        </div>

                        <div class="form-group">
                            <label>ุงูุฌูุณูุฉ *</label>
                            <input type="text" formControlName="nationality" placeholder="ุงูุณุนูุฏูุฉ">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group full-width">
                            <label>ุงูุนููุงู *</label>
                            <input type="text" formControlName="address" placeholder="ุงูุดุงุฑุนุ ุงูุญู">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>ุงููุฏููุฉ *</label>
                            <input type="text" formControlName="city" placeholder="ุงูุฑูุงุถ">
                        </div>

                        <div class="form-group">
                            <label>ุงูุฏููุฉ *</label>
                            <input type="text" formControlName="country" placeholder="ุงูุณุนูุฏูุฉ">
                        </div>
                    </div>
                </form>
            </div>
            }

            <!-- Step 2: Academic Background -->
            @if (currentStep() === 2) {
            <div class="wizard-step">
                <h2 class="step-title">{{ getStepIcon(2) }} ุงูุฎูููุฉ ุงูุฃูุงุฏูููุฉ</h2>

                <form [formGroup]="academicForm" class="wizard-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>ุงููุณุชูู ุงูุชุนูููู ุงูุญุงูู *</label>
                            <select formControlName="current_education_level">
                                <option value="">ุงุฎุชุฑ ุงููุณุชูู</option>
                                <option value="ุซุงูููุฉ ุนุงูุฉ">ุซุงูููุฉ ุนุงูุฉ</option>
                                <option value="ุจูุงููุฑููุณ">ุจูุงููุฑููุณ</option>
                                <option value="ูุงุฌุณุชูุฑ">ูุงุฌุณุชูุฑ</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>ุงููุนุฏู (GPA)</label>
                            <input type="number" formControlName="gpa" placeholder="95" min="0" max="100">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>ุณูุฉ ุงูุชุฎุฑุฌ *</label>
                            <input type="number" formControlName="graduation_year" placeholder="2023">
                        </div>

                        <div class="form-group">
                            <label>ุงูุฌุงูุนุฉ ุงูุณุงุจูุฉ (ุฅู ูุฌุฏุช)</label>
                            <input type="text" formControlName="previous_university" placeholder="ุฌุงูุนุฉ ุงูููู ุณุนูุฏ">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>IELTS Score</label>
                            <input type="number" formControlName="ielts_score" placeholder="7.0" step="0.5" min="0"
                                max="9">
                        </div>

                        <div class="form-group">
                            <label>TOEFL Score</label>
                            <input type="number" formControlName="toefl_score" placeholder="90" min="0" max="120">
                        </div>
                    </div>
                </form>
            </div>
            }

            <!-- Step 3: Program Selection -->
            @if (currentStep() === 3) {
            <div class="wizard-step">
                <h2 class="step-title">{{ getStepIcon(3) }} ุงุฎุชูุงุฑ ุงูุจุฑูุงูุฌ</h2>

                <form [formGroup]="programForm" class="wizard-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>ุงูุฌุงูุนุฉ *</label>
                            <select formControlName="university_id">
                                <option value="">ุงุฎุชุฑ ุงูุฌุงูุนุฉ</option>
                                <option value="1">ุฌุงูุนุฉ ูุงุฑูุงุฑุฏ</option>
                                <option value="2">MIT</option>
                                <option value="3">ุณุชุงูููุฑุฏ</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>ุงูุชุฎุตุต *</label>
                            <select formControlName="specialization_id">
                                <option value="">ุงุฎุชุฑ ุงูุชุฎุตุต</option>
                                <option value="1">ุนููู ุงูุญุงุณูุจ</option>
                                <option value="2">ุงูููุฏุณุฉ</option>
                                <option value="3">ุฅุฏุงุฑุฉ ุงูุฃุนูุงู</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group full-width">
                            <label>ุฑุณุงูุฉ ุงูุฏุงูุน</label>
                            <textarea formControlName="motivation_letter" rows="5"
                                placeholder="ุงูุชุจ ููุงุฐุง ุชุฑูุฏ ุงูุฏุฑุงุณุฉ ูู ูุฐุง ุงูุจุฑูุงูุฌ..."></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group full-width">
                            <label>ุงูุชูุงูุงุชู ุงูุจุญุซูุฉ</label>
                            <textarea formControlName="research_interests" rows="3"
                                placeholder="ูุฌุงูุงุช ุงูุงูุชูุงู ุงูุจุญุซู..."></textarea>
                        </div>
                    </div>
                </form>
            </div>
            }

            <!-- Step 4: Documents -->
            @if (currentStep() === 4) {
            <div class="wizard-step">
                <h2 class="step-title">{{ getStepIcon(4) }} ุงููุณุชูุฏุงุช</h2>

                <div class="documents-info">
                    <p>ูุฑุฌู ุชุญููู ุงููุณุชูุฏุงุช ุงูุชุงููุฉ (mock - ููุนุฑุถ ููุท):</p>
                </div>

                <form [formGroup]="documentsForm" class="wizard-form">
                    <div class="documents-list">
                        <div class="document-item">
                            <input type="checkbox" formControlName="passport_uploaded" id="passport">
                            <label for="passport">
                                <span class="doc-icon">๐ท</span>
                                <span class="doc-name">ุตูุฑุฉ ุฌูุงุฒ ุงูุณูุฑ</span>
                            </label>
                        </div>

                        <div class="document-item">
                            <input type="checkbox" formControlName="transcript_uploaded" id="transcript">
                            <label for="transcript">
                                <span class="doc-icon">๐</span>
                                <span class="doc-name">ูุดู ุงูุฏุฑุฌุงุช</span>
                            </label>
                        </div>

                        <div class="document-item">
                            <input type="checkbox" formControlName="diploma_uploaded" id="diploma">
                            <label for="diploma">
                                <span class="doc-icon">๐</span>
                                <span class="doc-name">ุงูุดูุงุฏุฉ</span>
                            </label>
                        </div>

                        <div class="document-item">
                            <input type="checkbox" formControlName="cv_uploaded" id="cv">
                            <label for="cv">
                                <span class="doc-icon">๐</span>
                                <span class="doc-name">ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ</span>
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            }
        </div>

        <!-- Navigation Buttons -->
        <div class="wizard-actions">
            <button class="btn btn-outline" (click)="previousStep()" [disabled]="currentStep() === 1">
                โ ุงูุณุงุจู
            </button>

            <button class="btn btn-ghost" (click)="saveDraft()">
                ๐พ ุญูุธ ุงููุณูุฏุฉ
            </button>

            @if (currentStep() < totalSteps) { <button class="btn btn-primary" (click)="nextStep()"
                [disabled]="!isCurrentStepValid()">
                ุงูุชุงูู โ
                </button>
                } @else {
                <button class="btn btn-success" (click)="submitApplication()"
                    [disabled]="isSubmitting() || !isCurrentStepValid()" [class.btn-loading]="isSubmitting()">
                    {{ isSubmitting() ? 'ุฌุงุฑู ุงูุฅุฑุณุงู...' : 'โ ุชูุฏูู ุงูุทูุจ' }}
                </button>
                }
        </div>
    </div>
</div>